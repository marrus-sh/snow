// Generated by CoffeeScript 1.12.4
/*

    ................. SNOW ..................

     A client-side frontend for Mastodon, a
    free & open-source social network server.
               - - by Kibigo! - -

        Licensed under the MIT License.
           Source code available at:
       https://github.com/marrus-sh/snow

                Version 0.1.0
 */
(function(){"use strict;";var FROM_PUBLIC,FROM_TAG,FROM_USER,GLOBAL,HOME,LAp,LAt,LAu,LCl,LEn,LFa,LOCAL,LPo,LPr,LRe,LRo,LTi,Lab,Locales,NOTFOUND,ONLY_LOCAL,ONLY_MEDIA,POST,SHOW_POST,SHOW_TIMELINE,SHOW_USER,TAG,USER,WITH_MENTIONS,authorize,cleanup,config,go,init,localized,locate,nobody,notfound,post,state,timeline,user,Œï,Œ£,Œ§,œÉ,œÑ,slice=[].slice,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1};Object.defineProperty(window,"Snow",{value:Object.freeze({"‚Ñπ":"https://github.com/marrus-sh/snow","N¬∫":1}),enumerable:!0}),config={},state={},localized={},cleanup=[],Lab=LAp=LAt=LAu=LCl=LEn=LFa=LPo=LPr=LRe=LRo=LTi=void 0,FROM_PUBLIC=1,FROM_USER=2,FROM_TAG=4,ONLY_LOCAL=8,ONLY_MEDIA=16,WITH_MENTIONS=32,SHOW_TIMELINE=64,SHOW_USER=128,SHOW_POST=256,NOTFOUND=0,HOME=SHOW_TIMELINE,LOCAL=SHOW_TIMELINE|FROM_PUBLIC|ONLY_LOCAL,GLOBAL=SHOW_TIMELINE|FROM_PUBLIC,TAG=SHOW_TIMELINE|FROM_TAG,USER=SHOW_TIMELINE|FROM_USER|SHOW_USER,POST=SHOW_USER|SHOW_POST,Locales={},Locales.en={"auth.placeholder":"example.com","auth.query":"What's your instance?","auth.username":"username","config.title":"Snow Web Client","error.laboratory":"This version of Laboratory is not supported.","location.all":"all","location.global":"global","location.local":"local","location.media":"media","location.tag":"tag","location.user":"user","link.home":"Home","link.local":"Local","link.global":"Global","notfound.notfound":"Not found!","notfound.message":"The page you were looking for does not exist."},init=function(){var INITIAL_STATE,data,elt,initial,j,len,locale,message,prop,ref,ref1,ref2,run,value;for(!(elt=document.getElementById("snow-config"))||"SCRIPT"!==elt.tagName.toUpperCase()||"application/json"!==elt.type&&"text/plain"!==elt.type||(config=JSON.parse(elt.text)),null==(void 0!==INITIAL_STATE&&null!==INITIAL_STATE?INITIAL_STATE.meta:void 0)&&(INITIAL_STATE={meta:{}}),initial={title:INITIAL_STATE.meta.title,basename:null!=INITIAL_STATE.meta.router_basename?INITIAL_STATE.meta.router_basename:"/web",locale:INITIAL_STATE.meta.locale,root:INITIAL_STATE.meta.react_root,defaultPrivacy:(null!=(ref=INITIAL_STATE.composer)?ref.default_privacy:void 0)||"unlisted",accessToken:INITIAL_STATE.meta.accessToken,origin:INITIAL_STATE.meta.origin||"/"},ref1=["title","basename","locale","root","defaultPrivacy","accessToken","origin"],j=0,len=ref1.length;j<len;j++)prop=ref1[j],null==config[prop]&&(config[prop]=initial[prop]);config.root=function(){switch(!1){case!(config.root&&(elt=document.getElementById(String(config.root)))):return elt;case!(elt=document.getElementById("frontend")):return elt;case!(elt=document.getElementsByClassName("app-body").item(0)):return elt;default:return document.body}}(),config.root.classList.add("üå®"),null==config.display&&(config.display=[]),config.display instanceof Array||(config.display=[config.display]),config.root.setAttribute("data-snow-display",config.display.join(" ")),ref2=config.locales;for(locale in ref2){data=ref2[locale],Locales[locale]instanceof Object||(Locales[locale]={});for(message in data)value=data[message],Locales[locale][message]=value}return null==config.locale&&(config.locale="en"),config.root.setAttribute("lang",config.locale),null==config.title&&(config.title=Œï("config.title")),document.title=config.title,run=function(){var callback;if(!("https://github.com/marrus-sh/laboratory"===Laboratory.‚Ñπ&&Laboratory.N¬∫>=5))throw new TypeError(Œï("error.laboratory"));return Lab=Laboratory,LAp=Laboratory.Application,LAt=Laboratory.Attachment,LAu=Laboratory.Authorization,LCl=Laboratory.Client,LEn=Laboratory.Enumeral,LFa=Laboratory.Failure,LPo=Laboratory.Post,LPr=Laboratory.Profile,LRe=Laboratory.Request,LRo=Laboratory.Rolodex,LTi=Laboratory.Timeline,config.accessToken?new LAu.Requested({accessToken:config.accessToken,origin:config.origin,scope:LAu.Scope.READWRITEFOLLOW}).start():authorize(),callback=function(){return go(),document.removeEventListener("LaboratoryAuthorizationReceived",callback)},document.addEventListener("LaboratoryAuthorizationReceived",callback)},("undefined"!=typeof Laboratory&&null!==Laboratory?Laboratory.ready:void 0)?run():document.addEventListener("LaboratoryInitializationReady",run)},window.addEventListener("load",init),Œ£=function(){var attribute,attributes,child,children,elt,j,len,name,value;if(name=arguments[0],attributes=arguments[1],children=3<=arguments.length?slice.call(arguments,2):[],elt=document.createElement(String(name)),attributes===Object(attributes))for(attribute in attributes)null!=(value=attributes[attribute])&&value!==!1&&elt.setAttribute(attribute,value===!0?"":value);for(j=0,len=children.length;j<len;j++)null!=(child=children[j])&&elt.appendChild(child instanceof Node?child:document.createTextNode(String(child)));return elt},œÉ=function(name,attributes,innerHTML){var attribute,elt,value;if(elt=document.createElement(String(name)),attributes===Object(attributes))for(attribute in attributes)null!=(value=attributes[attribute])&&value!==!1&&elt.setAttribute(attribute,value===!0?"":value);return elt.innerHTML=innerHTML,elt},Œ§=function(){var element,j,len,node,nodes;if(element=arguments[0],nodes=2<=arguments.length?slice.call(arguments,1):[],element instanceof Element){for(element.textContent="",j=0,len=nodes.length;j<len;j++)null!=(node=nodes[j])&&element.appendChild(node instanceof Node?node:document.createTextNode(String(node)));return element}},œÑ=function(){var element,j,len,node,nodes;if(element=arguments[0],nodes=2<=arguments.length?slice.call(arguments,1):[],element instanceof Element){for(j=0,len=nodes.length;j<len;j++)null!=(node=nodes[j])&&element.insertBefore(node instanceof Node?node:document.createTextNode(String(node)),this instanceof Node?this:null);return element}},Œï=function(key,locale){var result;return key=String(key),null==locale&&(locale=config.locale||"en"),locale=locale.toLowerCase(),null==localized[locale]&&(localized[locale]={}),null!=localized[locale][key]?localized[locale][key]:(result=function(){switch(!1){case!(null!=Locales[locale]&&null!=Locales[locale][key]):return Locales[locale][key];case"en"!==locale:return key;default:return Œï(key,indexOf.call(locale,"-")>=0?locale.substr(0,locale.indexOf("-")):"en")}}(),localized[locale][key]=result)},authorize=function(){var button,handleEvent,input;return handleEvent=function(event){if(("keypress"===event.type&&event.target===input&&("Enter"===event.key||"Enter"===event.code||13===event.keyCode)||"click"===event.type&&event.target===button)&&input.value.length&&input.validity.valid)return new LAu.Request({name:config.title,origin:"https://"+input.value,redirect:config.basename,scope:LAu.Scope.READWRITEFOLLOW}).start(window.open("about:blank","SnowOAuth")),input.value=""},Œ§(config.root,Œ£("DIV",{id:"üå®üîì"},Œ£("H1",void 0,Œï("auth.query")),Œ£("P",void 0,Œï("auth.username")+"@",input=Œ£("INPUT",{pattern:"[0-9A-Za-z\\-\\.]+(\\:[0-9]{1,4})?",placeholder:Œï("auth.placeholder")}),button=Œ£("BUTTON",void 0,"GO!")))),input.addEventListener("keypress",handleEvent),button.addEventListener("click",handleEvent)},go=function(){return Œ§(config.root,Œ£("A",{href:"#!/",target:"_self"},Œ£("HEADER",{id:"üå®‚ñî"},Œ£("H1",void 0,config.title))),state.window=Œ£("DIV",{id:"üå®üóî"}),state.composer=Œ£("DIV",{id:"üå®üìù"})),location.hash="#!/",locate(),window.addEventListener("hashchange",locate)},locate=function(){var base,fn,hash,j,len,path;for(j=0,len=cleanup.length;j<len;j++)"function"==typeof(fn=cleanup[j])&&fn();return cleanup=[],"#!/"!==(hash=location.hash).substr(0,3)&&(hash="#!/"),path=hash.substr(3).split("/"),base=path[0],state.location=function(){switch(base){case"":case void 0:return HOME;case Œï("location.global"):return GLOBAL;case Œï("location.local"):return LOCAL;case Œï("location.tag"):return state.query=+path[1],TAG;case Œï("location.user"):switch(state.query=+path[1],path[2]){case Œï("location.media"):return USER|ONLY_MEDIA;case Œï("location.all"):return USER|WITH_MENTIONS;case"":case void 0:return USER;default:return isNaN(path[2])?NOTFOUND:(state.status=+path[2],POST)}break;default:return NOTFOUND}}(),state.location===NOTFOUND?notfound():(state.location&SHOW_USER?user():nobody(),state.location&SHOW_TIMELINE&&timeline(),state.location&SHOW_POST?post():void 0)},notfound=function(){return state.timeline=null,Œ§(state.window,Œ£("DIV",{id:"üå®üõá"},Œ£("H2",null,Œï("notfound.notfound")),Œ£("P",null,Œï("notfound.message"))))},user=function(){var handleRequest,header,request;return header=void 0,handleRequest=function(response){if(response instanceof LPr)return Œ§(header,Œ£("A",{href:response.header,target:"_blank"},Œ£("IMG",{alt:"Header image for "+(response.displayName||response.account),src:response.header})),Œ£("A",{href:response.href,title:response.displayName,target:"_blank"},Œ£("IMG",{alt:(response.displayName||response.account)+"'s avatar",src:response.avatar}),Œ£("H2",void 0,response.displayName),Œ£("CODE",void 0,response.account)),œÉ("P",void 0,response.bio))},Œ§(state.window,header=Œ£("HEADER"),state.timeline=Œ£("DIV",{id:"üå®üìú"})),request=new LPr.Request({id:state.query}),request.assign(handleRequest),request.start(),cleanup.push(request.stop)},nobody=function(){var AorB;return AorB=function(useB,object,contents){return useB?Œ£("B",void 0,contents):Œ£("A",object,contents)},Œ§(state.window,Œ£("NAV",{id:"snow-navbar"},AorB(state.location&SHOW_TIMELINE&&!(state.location&FROM_PUBLIC),{href:"#!/",target:"_self"},Œï("link.home")),AorB(state.location&SHOW_TIMELINE&&state.location&ONLY_LOCAL,{href:"#!/"+Œï("location.local"),target:"_self"},Œï("link.local")),AorB(state.location&SHOW_TIMELINE&&state.location&FROM_PUBLIC&&!(state.location&ONLY_LOCAL),{href:"#!/"+Œï("location.global"),target:"_self"},Œï("link.global"))),state.timeline=Œ£("DIV",{id:"üå®üìú"}))},timeline=function(){var backRequest,handleBackRequest,handleRequest,renderStatus,request,timeout,tl,update;if((tl=state.timeline)instanceof Element)return timeout=null,update=function(req){return req.stop(),req.remove(handleRequest),req=req.prev(),req.assign(handleRequest),req.start()},renderStatus=function(status){var attachment,ref,scrollBottom;return scrollBottom=tl.scrollHeight-tl.scrollTop,Œ£("ARTICLE",void 0,Œ£("HEADER",void 0,Œ£("A",{href:"#!/"+Œï("location.user")+"/"+status.author.id,target:"_self"},Œ£("IMG",{alt:(status.author.displayName||status.author.account)+"'s avatar",src:status.author.avatar})),Œ£("A",{href:"#!/"+Œï("location.user")+"/"+status.author.id,target:"_self"},Œ£("B",void 0,status.author.displayName),Œ£("CODE",void 0,status.author.localAccount))),Œ£("DIV",{class:"üå®üì∞","data-snow-message":status.message?status.message:void 0},(null!=(ref=status.mediaAttachments)?ref.length:void 0)?Œ£("A",{href:"#!/"+[Œï("location.user"),status.author.id,status.id].join("/"),target:"_self"},Œ£.apply(null,["FIGURE",{"data-snow-attachment-count":status.mediaAttachments.length,"data-snow-nsfw":!!status.isNSFW}].concat(slice.call(function(){var j,len,ref1,results;for(ref1=status.mediaAttachments,results=[],j=0,len=ref1.length;j<len;j++)attachment=ref1[j],results.push(function(){var media;return media=attachment.type&LAt.Type.VIDEO?Œ£("VIDEO",{controls:attachment.type!==LAt.Type.GIFV,loop:attachment.type===LAt.Type.GIFV,muted:attachment.type===LAt.Type.GIFV,poster:attachment.preview,src:attachment.href}):Œ£("IMG",{src:attachment.href}),media.addEventListener("load",function(){return tl.scrollTop=tl.scrollHeight-scrollBottom}),attachment.type===LAt.Type.GIFV&&(media.addEventListener("mouseover",media.play),media.addEventListener("mouseleave",media.pause)),media}());return results}())))):void 0,œÉ("SECTION",void 0,status.content)),Œ£.apply(null,["FOOTER",void 0,Œ£("A",{href:"#!/"+[Œï("location.user"),status.author.id,status.id].join("/"),target:"_self"},status.datetime)].concat(slice.call(status.application?[" ‚Ä¢ ",status.application.href?Œ£("A",{href:status.application.href,target:"_blank"},status.application.name):status.application.name]:[]))))},handleRequest=function(response){var doScroll,i;if(response instanceof LTi)return tl.scrollTop===tl.scrollHeight-tl.clientHeight&&(doScroll=!0),response.length?(œÑ.apply(null,[tl].concat(slice.call(function(){var j,ref,results;for(results=[],i=j=ref=response.posts.length-1;ref<=0?j<=0:j>=0;i=ref<=0?++j:--j)results.push(renderStatus(response.posts[i]));return results}()))),doScroll&&(tl.scrollTop=tl.scrollHeight-tl.clientHeight),update(this)):timeout=window.setTimeout(this.start,3e3)},handleBackRequest=function(response){var scrollBottom,status;if(response instanceof LTi)return scrollBottom=tl.scrollHeight-tl.scrollTop,response.length&&œÑ.call.apply(œÑ,[tl.firstElementChild,tl].concat(slice.call(function(){var j,len,ref,results;for(ref=response.posts,results=[],j=0,len=ref.length;j<len;j++)status=ref[j],results.push(renderStatus(status));return results}()))),tl.scrollTop=tl.scrollHeight-scrollBottom},request=new LTi.Request({type:function(){switch(!1){case!(state.location&FROM_PUBLIC):return LTi.Type.PUBLIC;case!(state.location&FROM_TAG):return LTi.Type.HASHTAG;case!(state.location&FROM_USER):return LTi.Type.ACCOUNT;default:return LTi.Type.HOME}}(),query:state.location&FROM_USER||state.location&FROM_TAG?state.query:void 0,isLocal:state.location&ONLY_LOCAL}),request.assign(handleRequest),request.start(),backRequest=void 0,tl.addEventListener("scroll",function(){if(tl.scrollTop<32&&request.response){if(backRequest&&!backRequest.response)return;return backRequest&&(backRequest.stop(),backRequest.remove(handleBackRequest)),backRequest=(backRequest||request).next(),backRequest.assign(handleBackRequest),backRequest.start()}}),cleanup.push(function(){if(null!=timeout&&window.clearTimeout(timeout),request.stop(),backRequest)return backRequest.stop()})},post=function(){}}).call(this);